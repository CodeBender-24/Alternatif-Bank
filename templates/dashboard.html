{% extends 'base.html' %}

{% block content %}
<section class="dashboard">
  <div class="overview-card">
    <h1 class="section-title">Merhaba, {{ user['full_name'] }} ğŸ‘‹</h1>
    <p class="section-subtitle">Alternatif Bank hesabÄ±nÄ±zÄ±n Ã¶zetini aÅŸaÄŸÄ±da bulabilirsiniz.</p>
    <div class="balance-display">
      <span>Toplam Bakiyeniz</span>
      <strong>{{ 'â‚º{:,.2f}'.format(user['balance']).replace(',', 'X').replace('.', ',').replace('X', '.') }}</strong>
    </div>
  </div>

  <div class="grid-two-columns">
    <div class="card">
      <h2 class="card-title">Bakiye YÃ¼kle</h2>
      <form method="post" action="{{ url_for('deposit') }}" class="form-grid">
        <label for="deposit-amount">Tutar (â‚º)</label>
        <input type="number" step="0.01" min="0" id="deposit-amount" name="amount" placeholder="1000" required>

        <label for="deposit-note">AÃ§Ä±klama</label>
        <input type="text" id="deposit-note" name="note" placeholder="Opsiyonel aÃ§Ä±klama">

        <button type="submit" class="primary-button">Bakiye Ekle</button>
      </form>
    </div>

    <div class="card">
      <h2 class="card-title">Para Transferi</h2>
      <form method="post" action="{{ url_for('transfer') }}" class="form-grid">
        <label for="transfer-email">AlÄ±cÄ± E-postasÄ±</label>
        <input list="user-list" type="email" id="transfer-email" name="receiver_email" placeholder="alici@alternatifbank.com" required>
        <datalist id="user-list">
          {% for peer in users %}
            <option value="{{ peer['email'] }}">{{ peer['full_name'] }}</option>
          {% endfor %}
        </datalist>

        <label for="transfer-amount">Tutar (â‚º)</label>
        <input type="number" step="0.01" min="0" id="transfer-amount" name="amount" placeholder="500" required>

        <label for="transfer-note">AÃ§Ä±klama</label>
        <input type="text" id="transfer-note" name="note" placeholder="Opsiyonel aÃ§Ä±klama">

        <button type="submit" class="primary-button">Transferi GÃ¶nder</button>
      </form>
    </div>
  </div>

  <div class="card">
    <h2 class="card-title">Son Ä°ÅŸlemler</h2>
    {% if transactions %}
      <ul class="transaction-list">
        {% for trx in transactions %}
          <li class="transaction-item">
            <div>
              <span class="transaction-type {{ trx['type'] }}">{{ trx['type'] == 'deposit' and 'Bakiye YÃ¼kleme' or 'Transfer' }}</span>
              {% if trx['type'] == 'transfer' %}
                <p class="transaction-detail">
                  {% if trx['sender_id'] == user['id'] %}
                    <strong>{{ trx['receiver_name'] }}</strong> kiÅŸisine gÃ¶nderildi
                  {% else %}
                    <strong>{{ trx['sender_name'] }}</strong> kiÅŸisinden alÄ±ndÄ±
                  {% endif %}
                </p>
              {% else %}
                <p class="transaction-detail">{{ trx['note'] }}</p>
              {% endif %}
              {% if trx['note'] and trx['type'] == 'transfer' %}
                <p class="transaction-note">"{{ trx['note'] }}"</p>
              {% endif %}
            </div>
            <div class="transaction-meta">
              <span class="transaction-amount {{ 'negative' if trx['sender_id'] == user['id'] else 'positive' }}">
                {% if trx['sender_id'] == user['id'] %}-{% else %}+{% endif %}â‚º{{ '{:,.2f}'.format(trx['amount']).replace(',', 'X').replace('.', ',').replace('X', '.') }}
              </span>
              <span class="transaction-date">{{ trx['created_at'] }}</span>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="empty-state">HenÃ¼z iÅŸlem geÃ§miÅŸiniz yok. Hemen bir transfer baÅŸlatÄ±n!</p>
    {% endif %}
  </div>
</section>
{% endblock %}
